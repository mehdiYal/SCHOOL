{% extends 'ROLE_PARENT' in app.user.roles 
    ? 'baseParent.html.twig' 
    : 'base2.html.twig' %}
{% block body %}

	<div class="content-frame-body padding-bottom-0">
        <div class="row">
            <div class="col-md-12">
                <div id="alert_holder"></div>
                <div class="calendar">                                
        		<div id="calendar"></div>                            
                </div>
            </div>
        </div>
    </div>   


{% endblock %}

{% block javascripts %}
		
		{% dump(data) %}
		<script type="text/javascript">
				$('.active').removeClass('active');
                $('.plan').addClass('active');
                $('.pl').addClass('active');
			var j=0;
			datedeb = [];
			datefin = [];
			titletab = [];
		</script>
	{% for jour in data.jour %}
		{% for horraire in data.horraire %}
			{% for programme in data.programme %}
				{% if programme.jour.id==jour.id and programme.horraire.id==horraire.id %}
					<script type="text/javascript">
						var curr = new Date; 
						var first = curr.getDate() - curr.getDay(); 
						i=0;
						day=first;
						startDate=new Date(curr.setDate(day));
						for(i=0;i<5;i++){
							dateD=new Date(curr.setDate(day));
							dateF=new Date(curr.setDate(day));
							dateNom=dateD.toLocaleDateString('fr-FR', { weekday: 'long' });
							if(dateNom=="{{jour.nom}}"){
								dateD.setHours(new Date("{{horraire.heureDeb.date}}").getHours());
								dateD.setMinutes(new Date("{{horraire.heureDeb.date}}").getMinutes());
								datedeb[j]=dateD;
								titletab[j]= "{{programme.matiere.nom~' '~programme.enseignant.nom~' '~programme.salle.nom}}" ;
								dateF.setHours(new Date("{{horraire.heurefin.date}}").getHours());
								dateF.setMinutes(new Date("{{horraire.heurefin.date}}").getMinutes());
								datefin[j]=dateF;
								j++;
							}
							day++;

						}
					</script>
				{% endif %}
			{% endfor %}
		{% endfor %}
	{% endfor %}
	<script type="text/javascript" src="{{ asset('js/plugins/fullcalendar/fullcalendar.min.js')}}"></script>
	<script type="text/javascript" src="{{ asset('js/plugins/fullcalendar/lang/fr.js')}}"></script>
	
	<script type="text/javascript">
		$( document ).ready(function() {
			
			var curr = new Date; // get current date
			var first = curr.getDate() - curr.getDay(); // First day is the day of the month - the day of the week
			    
			i=0;
			day=first;

			
			var calendar = $('#calendar').fullCalendar({
				
					editable: false,
					
					minTime: "8:00",

	                maxTime: "18:00",

	                firstDay: 0,

	                hiddenDays: [ 5, 6 ],

					lang: 'fr',

					timezone : 'local',

					defaultView: 'agendaWeek',
				   	
				   	header: {
						left: 'prev,next today',
				    	center: 'title',
				    	right: 'agendaWeek,agendaDay'
				   	},


				   events: "events.php",
				   
				   eventRender: function(event, element, view) {

					    if (event.allDay === 'true') {

					     event.allDay = true;

					    } else {

					     event.allDay = false;

					    }

				   },
					   selectHelper: true,
			});
			
			length=j;
			
			for(var i=0;i<length;i++){
				calendar.fullCalendar('renderEvent',{
					title: titletab[i],
		   			start: datedeb[i],
		   			end: datefin[i],
					},true
				);
			};

			$('#calendar').fullCalendar('gotoDate', startDate);
		});

	</script>
{% endblock %}